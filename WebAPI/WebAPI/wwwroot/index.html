<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title></title>
</head>
<body>
  <div>
    <a href="api/values?ID=test&Password=test">values.Get</a>
    <a href="#" onclick="postEvent(); return false;">POST発行</a>
    <a href="api/values/alluser">Get 全ユーザー取得</a>
  </div>
  <div>
    <form method="get" action="api/values/adduser">
      <div>
        <input type="text" name="UserId" placeholder="ユーザーID" onkeydown="return ignoreEnterKey(event);" />
      </div>
      <div>
        <input type="text" name="UserName" placeholder="ユーザー名" onkeydown="return ignoreEnterKey(event);" />
      </div>
      <div>
        <input type="text" name="Password" placeholder="ユーザーパスワード" onkeydown="return ignoreEnterKey(event);" />
      </div>

      <input type="hidden" name="LoginUserID" value="test" />
      <button type="submit">ユーザー追加</button>
    </form>
  </div>

  <div>
    <a href="swagger" target="_blank">APIドキュメント(SwaggerUI)</a>
  </div>

  <script>
    //See:https://docs.microsoft.com/ja-jp/aspnet/core/security/anti-request-forgery

    function getCookie(cname) {
      var name = cname + "=";
      var decodedCookie = decodeURIComponent(document.cookie);
      var ca = decodedCookie.split(';');
      for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }

    /**
     * フォーム内テキストのエンターキー無効化
     * @param ev キー入力情報
     */
    function ignoreEnterKey(ev) {
      if ((ev.which && ev.which === 13) || (ev.keyCode && ev.keyCode === 13)) {
        return false;
      }
      return true;
    }

    function postEvent() {
      var csrfToken = getCookie("XSRF-TOKEN");

      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState == XMLHttpRequest.DONE) {
          if (xhttp.status == 200) {
            alert(xhttp.responseText);
          } else {
            alert('There was an error processing the AJAX request.');
          }
        }
      };
      xhttp.open('POST', '/api/values/Login', true);
      xhttp.setRequestHeader("Content-type", "application/json");
      xhttp.setRequestHeader("X-XSRF-TOKEN", csrfToken);
      xhttp.send(JSON.stringify({ "id": "test", "password": "test" }));
    }
  </script>
</body>
</html>